# Changelog

## v1.0.6-bata2 (2026-02-04)

### 🌟 新增功能 & 优化

- **Web 播放器**:
  - **网络代理控制**:
    - 设置界面新增 **播放音乐代理** 和 **下载音乐代理** 独立开关。
    - 允许用户根据网络环境自主选择是否通过服务器中转音频流。
    - ![v1.0.6-bata2 Settings](/md/log/1.0.6-bata2.png)
  - **播放体验优化**:
    - **加载状态提示**: 点击播放时显示直观的加载 Toast 提示。
    - **请求防抖 (Debounce)**: 优化频繁点击的处理逻辑，防止重复请求。
    - **并发请求管理**: 自动无视过时的播放请求结果，解决快速切歌可能导致的竞争问题。

## v1.0.6-bata1 (2026-02-04)

### 🔧 修复

- **Web 播放器**:
  - 修复下载音乐时未携带用户身份信息，导致服务端识别为 Guest 用户且无法访问私有源的问题。
  - 修复/api/music/download无法处理重定向的问题。
  - 修复在点击进度条时，没有判断 audio.duration 是否有效，计算出的播放时间可能是 NaN 或 Infinity，导致播放器重置到 0 的问题。

## v1.0.6 (2026-02-04)

### 🔧 修复

- **HTTPS 混合内容 (Mixed Content) 播放修复**:
  - 解决了在 HTTPS 环境下无法播放 HTTP 音源的问题。
  - **服务端增强**: 当检测到音源链接为不安全的 HTTP 协议时，服务端会自动将其重写为安全代理链接。
  - **体验优化**: 代理接口支持流式传输 (Inline)，无需下载文件即可直接在线播放。

## v1.0.5 (2026-02-04)

### 🌟 新增功能 & 优化

- **Media Session API (SMTC)**:
  - 支持 **Windows 系统媒体控制** (SMTC) 及移动端锁屏控制。
  - 支持在系统界面显示 **歌曲封面、标题、歌手** 等元数据。
  - 支持 **双向进度控制**：不仅显示进度，还支持通过系统进度条进行拖拽跳转 (Seek)。
  - ![v1.0.5 Media Session](/md/log/1.0.5.png)

## v1.0.4 (2026-02-04)

### 🔧 修复

- **Web 播放器**:
  - 修复播放音乐、获取歌词及搜索时未携带用户身份信息，导致服务端识别为 Guest 用户且无法访问私有源的问题。
  - 修复 `config.js` 变量作用域问题，确保界面能正确读取并显示版本号。

## v1.0.3 (2026-02-04)

### 🌟 新增功能 & 优化

- **自定义源 (Custom Source)**:
  - **存储隔离**: 采用新的存储结构，用户源存入 `{username}` 目录，公开源存入 `_open` 目录。
  - **权限控制**: 实现分级访问控制，登录用户可访问 私有+公开源，未登录用户仅可见公开源。
  - **UI 增强**:
    - 设置界面新增 **"启用公开源"** 开关，可自由切换是否显示公共脚本。
    - 新增 **源作用域标签** (公开/用户名)，清晰标识脚本归属。
    - 上传界面增加 **上传目标** 提示 (Upload Target)。

### 🔧 修复

- **Web 播放器**:
  - 修复本地/自动登录后用户名未及时同步到 UI 的问题。
  - 修复设置界面开关按钮样式显示异常。

## v1.0.2 (2026-02-04)

### 🔧 修复

- **文件管理器**:
  - 修复在线引用。

## v1.0.1 (2026-02-04)

### 🌟 新增功能 & 优化

- **Web 播放器**:
  - 优化移动端布局，减少详情页边缘留白，防止歌词在缩放时被遮挡。
  - 优化播放体验，切换歌曲时立即暂停当前播放。
- **管理控制台**:
  - 侧边栏增加版本号显示。

### 🔧 修复 & 改进

- **服务端**:
  - 改进自定义源获取音乐链接的重试逻辑：
    - 单一源失败时自动重试 3 次。
    - 多源支持时自动轮询尝试不同源。
