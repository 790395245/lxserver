# Changelog

## v1.2.3 (2026-02-09)

### 🔧 修复

- **Web 播放器**:
  - **歌词显示修复**: 修复了歌词在放大显示（高亮状态）时，若内容过长会超出容器边界被裁切的问题。优化了 CSS 布局，现在放大后的歌词会自动换行并保持在可视区域内，提供更佳的视觉体验。
  - **QQ 音乐收藏数据修复**: 修复了收藏 QQ 音乐 (tx) 歌曲时，数据保存格式不正确的问题。现在强制使用 `songmid` 作为唯一标识符 (ID)，确保与客户端数据格式一致，解决了导入 LX 客户端时可能出现的兼容性问题。
  - **界面修复**:
    - **关于页面**: 修复了关于页面内容无法正常显示的问题。
    - **内容遮挡**: 修复了关于页和设置页顶部内容被头部导航栏遮挡的问题。
    - **标签样式**: 修复了“自定义源”标签在窄屏下文字换行的问题，现在标签内容会保持在一行显示。
    - **移动端标题对齐**: 修复了移动端切换封面显示状态后，歌曲标题对其方式异常（变成左对齐）的问题，现在始终保持居中。

## v1.2.2 (2026-02-07)

### 🌟 新增功能

- **通知系统**:
  - **通知中心**: 集成 PostHog 远程配置功能，支持动态推送 **版本更新提醒**、**系统维护公告** 及 **运营消息**。
  - **多样式弹窗**: 针对不同类型的通知（更新、警告、成功、普通）设计了不同的视觉风格（火箭、警示、对勾、铃铛）。
  - **智能队列**: 支持多条通知排队显示，避免弹窗重叠。
  - **主题适配**: 弹窗自动适配当前音乐播放器的主题配色。

## v1.2.1 (2026-02-07)

### 🌟 新增功能

- **Web 播放器**:
  - **自定义歌词字体**: 支持 **读取本地已安装字体列表** (需浏览器支持)，或从预设的常用中英文字体中选择。
  - ![v1.2.1 Font List](/md/log/1.2.1-0.png)
  - **字体设置与预览**: 设置页新增歌词字体选项，支持实时预览数字、英文及中文效果。
  - ![v1.2.1 Font Preview](/md/log/1.2.1-1.png)
  - **界面效果**: 播放器歌词应用自定义字体效果。
  - ![v1.2.1 Player Lyric](/md/log/1.2.1-2.png)

### 🔧 修复

- **Web 播放器**:
  - **界面交互**: 修复了切换主题色时，CSS 滤镜会错误地应用到已加载的真实专辑封面，导致预览图变色的问题。现在滤镜仅作用于占位 Logo，确保封面显示原始色彩。
  - **界面修复**: 修复了在电脑端隐藏底部播放控制栏时，歌词区域高度异常导致“NOW PLAYING”标题被遮挡的问题。通过动态调整容器顶部内边距（Padding）解决了此问题。
  - **歌词滚动优化**: 修复了手动滚动歌词时，指示器虚线高度计算错误的问题。现在指示器位置能够精准匹配自动播放时的行中心，且不受顶部标题区域高度和控制面板隐藏状态的影响。
  - **歌词显示优化**: 修复了歌词放大后会被容器内边距遮挡的问题。移除了 `player-detail-container` 的水平内边距，使歌词能够利用更宽的空间进行显示。

## v1.2.0 (2026-02-06)

### 🌟 新增功能

- **隐私与安全**:
  - **匿名数据统计**: 集成 PostHog 用于服务端的错误追踪和匿名使用统计（仅收集版本号、运行环境等非敏感信息）。
    - **默认开启**: 用于帮助开源项目改进和发现 Bug。
    - **可配置关闭**: 支持通过环境变量 `DISABLE_TELEMETRY=true` 完全禁用此功能。
  - **隐私承诺**: 明确声明绝不收集 IP 地址、主机名或具体用户数据。
- **Web 播放器**:
  - **详情页交互优化**:
    - **沉浸式歌词**: 当隐藏封面时，歌词区域将自动扩展并居中显示，提供更好的大屏阅读体验。
    - **电脑版播放控制器隐藏按钮**: 增加播放控制器隐藏按钮，点击后隐藏播放控制器。
    - ![v1.2.0 Lyrics](/md/log/1.2.0.png)
    - **可控制热搜开关**: 增加热搜显示条目设置，设置为0关闭热搜显示。
    - ![v1.2.0 HotSearch](/md/log/1.2.0-0.png)
    - **主题色设置**：设置中新增加 显示(Display) Tab，可以在其中选择主题色。
    - ![v1.2.0 Theme](/md/log/1.2.0-1.png)
    - **歌词字体大小设置**：设置中新增加 显示(Display) Tab，可以在其中设置歌词字体大小。
    - ![v1.2.0 Theme](/md/log/1.2.0-2.png)
    - **播放列表逻辑优化**: 仅在播放搜索列表歌曲时才将其加入“默认列表”，播放已收藏歌曲时不再重复添加，保持列表整洁。


### 🔧 修复

- **Web 播放器**:
  - **歌词同步修复**: 彻底修复了在网络状况不佳时，歌词先于歌曲加载完成并自动开始滚动，导致播放开始后歌词进度严重不同步的问题。现在，歌词滚动将严格等待歌曲真正开始播放 (`play` 事件) 后才启动，并会自动对齐到当前播放进度，确保音画同步。
  - **滚动优化**: 修复了滚动逻辑判断不准确的问题。

## v1.1.0 (2026-02-05)

### 🌟 新增功能 & 优化

- **Web 播放器**:
  - **歌词显示优化**:
    - 优化手机端歌词显示逻辑，增加课隐藏player-control-panel按钮
    - ![v1.1.0 Lyrics](/md/log/1.1.0.png)

### 🔧 修复

- **数据同步服务**:
  - 修复多用户使用相同密码时，客户端可能因缓存旧密钥而连接到错误用户的问题。
  - **路径一致性校验**: 当启用路径模式 (`user.enablePath`) 时，服务端现在会强制校验 URL 路径中的用户名（如 `/test`）是否与提供的认证凭证（密钥或密码）所属用户一致。如果不一致（例如使用 `admin` 的密钥连接 `/test`），服务端将拒绝连接 (401)，从而强制客户端重新进行正确的身份认证。
  - **收藏**:
    - 播放的音乐都会加入默认播放列表
    - 收藏音乐逻辑同步LX客户端，解决导入LX客户端崩溃问题
    - 收藏音乐创建歌单，界面显示等BUG修复
  

## v1.0.6-bata2 (2026-02-04)

### 🌟 新增功能 & 优化

- **Web 播放器**:
  - **网络代理控制**:
    - 设置界面新增 **播放音乐代理** 和 **下载音乐代理** 独立开关。
    - 允许用户根据网络环境自主选择是否通过服务器中转音频流。
    - ![v1.0.6-bata2 Settings](/md/log/1.0.6-bata2.png)
  - **播放体验优化**:
    - **加载状态提示**: 点击播放时显示直观的加载 Toast 提示。
    - **请求防抖 (Debounce)**: 优化频繁点击的处理逻辑，防止重复请求。
    - **并发请求管理**: 自动无视过时的播放请求结果，解决快速切歌可能导致的竞争问题。

## v1.0.6-bata1 (2026-02-04)

### 🔧 修复

- **Web 播放器**:
  - 修复下载音乐时未携带用户身份信息，导致服务端识别为 Guest 用户且无法访问私有源的问题。
  - 修复/api/music/download无法处理重定向的问题。
  - 修复在点击进度条时，没有判断 audio.duration 是否有效，计算出的播放时间可能是 NaN 或 Infinity，导致播放器重置到 0 的问题。

## v1.0.6 (2026-02-04)

### 🔧 修复

- **HTTPS 混合内容 (Mixed Content) 播放修复**:
  - 解决了在 HTTPS 环境下无法播放 HTTP 音源的问题。
  - **服务端增强**: 当检测到音源链接为不安全的 HTTP 协议时，服务端会自动将其重写为安全代理链接。
  - **体验优化**: 代理接口支持流式传输 (Inline)，无需下载文件即可直接在线播放。

## v1.0.5 (2026-02-04)

### 🌟 新增功能 & 优化

- **Media Session API (SMTC)**:
  - 支持 **Windows 系统媒体控制** (SMTC) 及移动端锁屏控制。
  - 支持在系统界面显示 **歌曲封面、标题、歌手** 等元数据。
  - 支持 **双向进度控制**：不仅显示进度，还支持通过系统进度条进行拖拽跳转 (Seek)。
  - ![v1.0.5 Media Session](/md/log/1.0.5.png)

## v1.0.4 (2026-02-04)

### 🔧 修复

- **Web 播放器**:
  - 修复播放音乐、获取歌词及搜索时未携带用户身份信息，导致服务端识别为 Guest 用户且无法访问私有源的问题。
  - 修复 `config.js` 变量作用域问题，确保界面能正确读取并显示版本号。

## v1.0.3 (2026-02-04)

### 🌟 新增功能 & 优化

- **自定义源 (Custom Source)**:
  - **存储隔离**: 采用新的存储结构，用户源存入 `{username}` 目录，公开源存入 `_open` 目录。
  - **权限控制**: 实现分级访问控制，登录用户可访问 私有+公开源，未登录用户仅可见公开源。
  - **UI 增强**:
    - 设置界面新增 **"启用公开源"** 开关，可自由切换是否显示公共脚本。
    - 新增 **源作用域标签** (公开/用户名)，清晰标识脚本归属。
    - 上传界面增加 **上传目标** 提示 (Upload Target)。

### 🔧 修复

- **Web 播放器**:
  - 修复本地/自动登录后用户名未及时同步到 UI 的问题。
  - 修复设置界面开关按钮样式显示异常。

## v1.0.2 (2026-02-04)

### 🔧 修复

- **文件管理器**:
  - 修复在线引用。

## v1.0.1 (2026-02-04)

### 🌟 新增功能 & 优化

- **Web 播放器**:
  - 优化移动端布局，减少详情页边缘留白，防止歌词在缩放时被遮挡。
  - 优化播放体验，切换歌曲时立即暂停当前播放。
- **管理控制台**:
  - 侧边栏增加版本号显示。

### 🔧 修复 & 改进

- **服务端**:
  - 改进自定义源获取音乐链接的重试逻辑：
    - 单一源失败时自动重试 3 次。
    - 多源支持时自动轮询尝试不同源。
